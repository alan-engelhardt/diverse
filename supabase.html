<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test</title>
    <style>
        body {
            max-width: 900px;
            margin: auto;
        }

        a {
            padding: .5rem;
            margin: .2rem;
            text-decoration: none;
            border-radius: .5rem;
            background-color: #333;
            color: white;
        }

        main {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
    </style>
</head>

<body>
    <h1>Supabase test</h1>
    <nav><a href="?">Alle</a><a href="?season=marts">Marts</a><a href="?season=juni">Juni</a></nav>
    <main></main>
    <template>
        <article>
            <h2></h2>
            <label for="areas">Områder</label>
            <ul class="areas"></ul>
            <label for="season">Sæson</label>
            <ul class="season"></ul>
        </article>
    </template>
    <script>
        const params = new URLSearchParams(window.location.search);
        const navn = params.get("navn");
        const season = params.get("season");
        console.log(navn);

        const url = "https://jftyavgnjvzhcjchqdpg.supabase.co/rest/v1/test1"
        const key = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmdHlhdmduanZ6aGNqY2hxZHBnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDc3NTQ3MTIsImV4cCI6MjAyMzMzMDcxMn0.Tov11N_g-ERTctEqGBbYOr8FgVmDLWfB_-m1MbWcnEw";
        const options = {
            method: "GET",
            headers: {
                apikey: key
            }
        }

        window.addEventListener("load", () => hentNavne());

        function hentNavne() {
            const endp = url + "?select=navn";
            fetch(endp, options).then(res => res.json()).then(bygNav);
        }

        function bygNav(navne) {
            const nav = document.querySelector("nav");
            navne.forEach(elm => {
                console.log(elm.navn)
                nav.innerHTML += `<a href="?navn=${elm.navn}">${elm.navn}</a>`;
            });
            hentData();
        }

        function hentData() {
            //const endp = navn ? url + "?navn=eq." + navn : url;
            if (navn) {
                endp = url + "?navn=eq." + navn;
            } else if (season) {
                endp = `${url}?seasons=ilike.*${season}*`;
            } else {
                endp = url;
            }
            fetch(endp, options).then(res => res.json()).then(visData);
        }

        function visData(data) {
            console.log("data: " + data);
            const template = document.querySelector("template").content;
            const main = document.querySelector("main")
            data.forEach(elm => {
                const klon = template.cloneNode(true);
                klon.querySelector("h2").textContent = elm.navn;
                elm.areas.split(", ").forEach(elm => {
                    klon.querySelector(".areas").innerHTML += "<li>" + elm + "</li>";
                })
                elm.seasons.split(", ").forEach(elm => {
                    klon.querySelector(".season").innerHTML += "<li>" + elm + "</li>";
                })
                main.appendChild(klon);
            });
        }
    </script>
</body>

</html>